<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock ‚Äì Alto Port√°tiles</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../css/panel.css" />
  <link rel="icon" type="image/png" href="../recursos/imagenes/logo.png" />
</head>

<body class="dashboard-body">
  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <img src="../recursos/imagenes/AltoPortatiles.png" alt="Alto Port√°tiles" class="brand-logo" />
      </div>
      <div id="whoami" class="whoami" style="text-align:center; padding:6px 0; opacity:.8;"></div>

      <nav class="side-nav">
        <a class="item" href="./inicio.html" data-roles="Administrador,Empleado">
          <img src="../recursos/iconos/inicio.svg" class="icon-svg" alt=""><span>Inicio</span>
        </a>

        <a class="item" href="./gestion.html" data-roles="Administrador,Empleado">
          <img src="../recursos/iconos/gestion.svg" class="icon-svg" alt=""><span>Gesti√≥n</span>
        </a>

        <a class="item" href="./logistica.html" data-roles="Administrador,Empleado">
          <img src="../recursos/iconos/logistica.svg" class="icon-svg" alt=""><span>Log√≠stica</span>
        </a>

        <a class="item" href="./tareasAdm.html" data-roles="Administrador,Empleado">
          <img src="../recursos/iconos/tareas.svg" class="icon-svg" alt=""><span>Tareas</span>
        </a>

        <a class="item" href="./reportes.html" data-roles="Administrador">
          <img src="../recursos/iconos/reportes.svg" class="icon-svg" alt=""><span>Reportes</span>
        </a>

        <a class="item active" href="./stock.html" data-roles="Administrador">
          <img src="../recursos/iconos/stock.svg" class="icon-svg" alt=""><span>Stock</span>
        </a>

        <a class="item" href="./usuarios.html" data-roles="Administrador">
          <img src="../recursos/iconos/usuarios.svg" class="icon-svg" alt=""><span>Usuarios</span>
        </a>
      </nav>

      <nav class="side-nav logout">
        <a class="item logout-item" href="#" data-roles="Administrador,Empleado">
          <img src="../recursos/iconos/logout.svg" class="icon-svg" alt=""><span>Logout</span>
        </a>
      </nav>
    </aside>

    <!-- CONTENIDO -->
    <main class="content">

      <!-- PESTA√ëAS -->
      <section class="card" style="margin-bottom:14px;">
        <div class="tabs-toggle">
          <button class="tabs-btn active" data-tab="stock">Stock</button>
          <button class="tabs-btn" data-tab="proveedores">Proveedores</button>
          <button class="tabs-btn" data-tab="productos">Movimientos</button>
        </div>
      </section>

      <!-- ================== TAB STOCK (NUEVA) ================== -->
      <section id="tabStock" class="tab-panel">
        <section class="card">
          <div class="toolbar" style="justify-content: space-between;">
            <div class="input-wrap" style="flex: 1; max-width: 300px;">
              <input id="stkBuscar" type="text" class="input" placeholder="Buscar producto..." />
            </div>
            <div class="input-wrap" style="flex: 1; max-width: 200px;">
              <input id="stkFiltroCant" type="number" class="input" placeholder="Cantidad menor a..." />
            </div>
          </div>

          <div class="tabla-wrap">
            <table class="tabla tabla-stack">
              <thead>
                <tr>
                  <th class="sortable" data-sort="nombre" style="cursor:pointer;">Producto <span id="sortIconNombre">‚Üï</span></th>
                  <th>Unidad</th>
                  <th class="sortable" data-sort="cantidad" style="cursor:pointer;">Cantidad Total <span id="sortIconCantidad">‚Üï</span></th>
                  <th style="width:100px;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyStock"><!-- JS --></tbody>
            </table>
          </div>
        </section>
      </section>

      <!-- ================== TAB PROVEEDORES ================== -->
      <section id="tabProveedores" class="tab-panel hidden">

        <!-- BUSCADOR + TABLA PROVEEDORES -->
        <section class="card">
          <div class="toolbar" style="justify-content: space-between;">
            <div class="input-wrap w-60" style="width:100%;">
              <input id="provBuscar" type="text" class="input"
                     placeholder="Buscar (nombre, tel√©fono, direcci√≥n, email)" />
            </div>
          </div>

          <div class="tabla-wrap">
            <table class="tabla tabla-stack">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Tel√©fono</th>
                  <th>Direcci√≥n</th>
                  <th>Email</th>
                  <th style="width:130px;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyProveedores"><!-- JS --></tbody>
            </table>
          </div>
        </section>

        <!-- FORMULARIO PROVEEDOR -->
        <section class="card">
          <form id="formProveedor" class="form-vertical form-proveedor">
            <input type="hidden" id="provId">

            <label>Nombre
              <input id="provNombre" class="input" type="text" placeholder="Ej: Limpieza S.A" required>
            </label>

            <label>Tel√©fono
              <input id="provTelefono" class="input" type="text" placeholder="Ej: 3516789865" maxlength="10">
            </label>

            <label>Direcci√≥n
              <input id="provDireccion" class="input" type="text" placeholder="Ej: Arturo Capdevila 2032">
            </label>

            <label>Email
              <input id="provEmail" class="input" type="email" placeholder="Ej: proveedor@empresa.com">
            </label>

            <div class="form-actions right">
              <button type="submit" class="btn primary">Guardar</button>
              <button type="button" id="provCancelar" class="btn outline">Cancelar</button>
            </div>
          </form>
        </section>
      </section>

      <!-- ================== TAB PRODUCTOS ================== -->
      <section id="tabProductos" class="tab-panel hidden">

        <!-- BUSCADOR + TABLA MOVIMIENTOS DE PRODUCTOS -->
        <section class="card">
          <div class="toolbar" style="justify-content: space-between;">
            <div class="input-wrap w-60" style="width:100%;">
              <input id="movBuscar" type="text" class="input"
                     placeholder="Buscar (fecha, proveedor, producto, m√©todo)" />
            </div>
          </div>

          <div class="tabla-wrap">
            <table class="tabla tabla-stack">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Proveedor</th>
                  <th>Producto</th>
                  <th>Cantidad √∫til</th>
                  <th>Precio</th>
                  <th>M√©todo</th>
                  <th style="width:130px;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyMovimientos"><!-- JS --></tbody>
            </table>
          </div>
        </section>

        <!-- FORMULARIO MOVIMIENTO / COMPRA -->
        <section class="card">
          <form id="formMovimiento" class="form-vertical form-proveedor">

            <input type="hidden" id="movId">

            <label>Fecha
              <input id="movFecha" type="date" class="input">
            </label>

            <label>Proveedor
              <select id="movProveedor" class="input">
                <!-- opciones por JS -->
              </select>
            </label>

            <label>Producto
              <div class="select-with-plus">
                <select id="movProducto" class="input">
                  <!-- opciones por JS -->
                </select>
                <button type="button" class="btn-plus" id="btnNuevoProducto">+</button>
              </div>
            </label>

            <label>Cantidad
              <input id="movCantidad" type="number" min="0" class="input" placeholder="Ej: 50">
            </label>

            <label>Precio
              <input id="movPrecio" type="number" min="0" step="0.01" class="input" placeholder="Ej: 150000">
            </label>

            <label>M√©todo
              <select id="movMetodo" class="input">
                <option value="">Seleccionar m√©todo</option>
                <option>Transferencia</option>
                <option>Efectivo</option>
                <option>Tarjeta</option>
              </select>
            </label>

            <div class="form-actions right">
              <button type="submit" class="btn primary">Guardar</button>
              <button type="button" id="movCancelar" class="btn outline">Cancelar</button>
            </div>
          </form>
        </section>
      </section>

    </main>
  </div>

  <!-- MODAL: NUEVO PRODUCTO -->
  <div class="modal-overlay hidden" id="modalNuevoProducto">
    <div class="modal modal-small">
      <div class="modal-header">
        <h2>CARGAR NUEVO PRODUCTO</h2>
      </div>

      <div class="modal-body">
        <form id="formNuevoProducto" class="form-vertical">
          <label>Nombre
            <input id="prodNombre" type="text" class="input" placeholder="Ej: Papel higi√©nico" required />
          </label>

          <div id="wrapperUnidad">
            <label id="labelComboUnidad">Unidad
                <div style="display: flex; gap: 5px;">
                    <select id="prodUnidadSelect" class="input">
                        </select>
                    <button type="button" class="btn-plus" id="btnHabilitarNuevaUnidad" style="font-size: 14px; min-width: 40px;" title="Agregar nueva unidad">‚úé</button>
                </div>
            </label>

            <label id="labelNuevaUnidad" class="hidden">Nueva Unidad
                <div style="display: flex; gap: 5px;">
                    <input id="prodUnidadNueva" type="text" class="input" placeholder="Ej: metros, bultos...">
                    <button type="button" class="btn primary" id="btnGuardarNuevaUnidad" style="min-width: 40px;">OK</button>
                    <button type="button" class="btn outline" id="btnCancelarNuevaUnidad" style="min-width: 40px;">üîô</button>
                </div>
            </label>
        </div>

          <div class="form-actions">
            <button type="submit" class="btn primary">Guardar</button>
            <button type="button" id="btnCerrarNuevoProducto" class="btn outline">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- MODAL: EDITAR STOCK (AJUSTE) -->
  <div class="modal-overlay hidden" id="modalEditarStock">
    <div class="modal modal-small">
      <div class="modal-header">
        <h2>AJUSTAR STOCK</h2>
      </div>
      <div class="modal-body">
        <form id="formEditarStock" class="form-vertical">
          <input type="hidden" id="stkIdProducto">
          <h3 id="stkNombreProducto" style="text-align:center; margin-bottom:10px; color:var(--rojo);"></h3>
          
          <label>Stock Actual
            <input id="stkCantidadActual" type="number" class="input" disabled style="background:#eee;" />
          </label>

          <label>Nueva Cantidad Real
            <input id="stkNuevaCantidad" type="number" class="input" required />
          </label>

          <div class="form-actions">
            <button type="submit" class="btn primary">Guardar Ajuste</button>
            <button type="button" id="btnCancelarStock" class="btn outline">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ================== SCRIPTS ================== -->

  <!-- app.js debe ser module porque usa import -->
  <script type="module" src="../js/app.js"></script>

  <!-- Si estos archivos despu√©s importan supabase, tambi√©n deben ser module -->
  <script type="module" src="../js/stockProveedores.js"></script>
  <script type="module" src="../js/stockProductos.js"></script>

  <!-- Tabs Proveedores / Productos -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btns = document.querySelectorAll('.tabs-btn');
      const tabProv = document.getElementById('tabProveedores');
      const tabProd = document.getElementById('tabProductos');
      const tabStock = document.getElementById('tabStock');
      
      const tabs = {
        stock: tabStock,
        proveedores: tabProv,
        productos: tabProd
      };

      btns.forEach(btn => {
        btn.addEventListener('click', () => {
          const target = btn.dataset.tab;
          btns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          Object.keys(tabs).forEach(k => {
             if (k === target) tabs[k].classList.remove('hidden');
             else tabs[k].classList.add('hidden');
          });
        });
      });
    });
  </script>

</body>
</html>
